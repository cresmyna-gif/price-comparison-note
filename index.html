<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯”åƒ¹æ›ç®—ç­†è¨˜æœ¬ (2025ç‰ˆ)</title>
    <style>
        :root { --color-A: #ff9800; --color-B: #2196f3; --bg: #f0f2f5; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 850px; }
        .compare-area { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); flex: 1; min-width: 320px; border-top: 6px solid #ccc; }
        .card.A { border-top-color: var(--color-A); }
        .card.B { border-top-color: var(--color-B); }
        .name-input { width: 100%; font-size: 20px; font-weight: bold; text-align: center; border: none; border-bottom: 2px solid #eee; margin-bottom: 15px; padding: 5px; color: #333; }
        .name-input:focus { outline: none; border-bottom-color: #999; }
        label { display: block; margin: 12px 0 6px; font-weight: bold; color: #666; font-size: 14px; }
        
        .unit-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        input[type="number"] { flex: 1; min-width: 60px; }
        select { width: 90px; cursor: pointer; }
        .unit-info { font-size: 13px; color: #888; white-space: nowrap; }

        .unit-price-display { background: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 15px; text-align: center; border: 1px dashed #ddd; }
        .unit-price-display strong { font-size: 1.2em; color: #333; }
        .result-zone { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; }
        #winnerLabel { font-size: 22px; font-weight: bold; margin-bottom: 15px; display: block; }
        .save-bar { display: flex; gap: 10px; justify-content: center; }
        .btn-save { background: #4caf50; color: white; border: none; padding: 10px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .history-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .btn-del { background: #ff5252; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .hist-detail { font-size: 14px; color: #444; line-height: 1.8; }
        
        /* æ­·å²ç´€éŒ„ç²å‹è€…é¡è‰² */
        .win-A { color: var(--color-A); font-weight: bold; }
        .win-B { color: var(--color-B); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: #333;">ğŸ›’ æ¯”åƒ¹æ›ç®—ç­†è¨˜æœ¬ (2025ç‰ˆ)</h1>

    <div class="compare-area">
        <div class="card A">
            <input type="text" id="nameA" class="name-input" value="å•†å“ A">
            <label>åƒ¹æ ¼ (å…ƒ)</label>
            <input type="number" id="pA" value="49">
            <label>é‡é‡èˆ‡å–®ä½</label>
            <div class="unit-row">
                <input type="number" id="qA" value="1">
                <select id="uA">
                    <option value="1000" data-desc="(æ¯å…¬æ–¤1000g)">å…¬æ–¤</option>
                    <option value="600" data-desc="(æ¯å°æ–¤600g)" selected>å°æ–¤</option>
                    <option value="37.5" data-desc="(æ¯å…©37.5g)">å…©</option>
                    <option value="453.6" data-desc="(æ¯ç£…453.6g)">ç£…</option>
                    <option value="1" data-desc="(æ¯å…¬å…‹1g)">å…¬å…‹</option>
                </select>
                <span id="descA" class="unit-info">(æ¯å°æ–¤600g)</span>
            </div>
            <div class="unit-price-display">
                <strong id="kgA">--</strong><span> / å…¬æ–¤</span>
            </div>
        </div>

        <div class="card B">
            <input type="text" id="nameB" class="name-input" value="å•†å“ B">
            <label>åƒ¹æ ¼ (å…ƒ)</label>
            <input type="number" id="pB" value="85">
            <label>é‡é‡èˆ‡å–®ä½</label>
            <div class="unit-row">
                <input type="number" id="qB" value="1">
                <select id="uB">
                    <option value="1000" data-desc="(æ¯å…¬æ–¤1000g)" selected>å…¬æ–¤</option>
                    <option value="600" data-desc="(æ¯å°æ–¤600g)">å°æ–¤</option>
                    <option value="37.5" data-desc="(æ¯å…©37.5g)">å…©</option>
                    <option value="453.6" data-desc="(æ¯ç£…453.6g)">ç£…</option>
                    <option value="1" data-desc="(æ¯å…¬å…‹1g)">å…¬å…‹</option>
                </select>
                <span id="descB" class="unit-info">(æ¯å…¬æ–¤1000g)</span>
            </div>
            <div class="unit-price-display">
                <strong id="kgB">--</strong><span> / å…¬æ–¤</span>
            </div>
        </div>
    </div>

    <div class="result-zone">
        <span id="winnerLabel">è«‹è¼¸å…¥è³‡æ–™...</span>
        <div class="save-bar">
            <input type="text" id="note" placeholder="æœ¬æ¬¡æ¯”è¼ƒå‚™è¨» (å¦‚ï¼šç•ªèŒ„)">
            <button class="btn-save" onclick="saveToHistory()">å„²å­˜æ­¤ç´€éŒ„</button>
        </div>
    </div>

    <div class="history-card">
        <h3 style="margin-top:0;">ğŸ“‹ æ­·å²æ¯”åƒ¹ç´€éŒ„</h3>
        <table>
            <thead>
                <tr>
                    <th>æ—¥æœŸèˆ‡å‚™è¨»</th>
                    <th>æ¯”è¼ƒæ˜ç´°</th>
                    <th>çµæœ</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="historyBody"></tbody>
        </table>
    </div>
</div>

<script>
    function update() {
        const selA = document.getElementById('uA');
        document.getElementById('descA').innerText = selA.options[selA.selectedIndex].getAttribute('data-desc');
        const selB = document.getElementById('uB');
        document.getElementById('descB').innerText = selB.options[selB.selectedIndex].getAttribute('data-desc');

        const nameA = document.getElementById('nameA').value;
        const nameB = document.getElementById('nameB').value;
        const pA = parseFloat(document.getElementById('pA').value) || 0;
        const qA = parseFloat(document.getElementById('qA').value) || 0;
        const uA = parseFloat(selA.value);
        const pB = parseFloat(document.getElementById('pB').value) || 0;
        const qB = parseFloat(document.getElementById('qB').value) || 0;
        const uB = parseFloat(selB.value);

        const valA = qA > 0 ? (pA / (qA * uA)) * 1000 : Infinity;
        const valB = qB > 0 ? (pB / (qB * uB)) * 1000 : Infinity;

        document.getElementById('kgA').innerText = isFinite(valA) ? valA.toFixed(1) : "--";
        document.getElementById('kgB').innerText = isFinite(valB) ? valB.toFixed(1) : "--";

        const label = document.getElementById('winnerLabel');
        if (!isFinite(valA) || !isFinite(valB)) {
            label.innerText = "è«‹è¼¸å…¥åƒ¹æ ¼èˆ‡é‡é‡";
            label.style.color = "#888";
        } else if (valA < valB) {
            label.innerText = `ğŸ† ${nameA} æ¯”è¼ƒåˆ’ç®—ï¼`;
            label.style.color = "var(--color-A)";
        } else if (valB < valA) {
            label.innerText = `ğŸ† ${nameB} æ¯”è¼ƒåˆ’ç®—ï¼`;
            label.style.color = "var(--color-B)";
        } else {
            label.innerText = "å…©è€…åƒ¹æ ¼ç›¸åŒ";
            label.style.color = "#333";
        }
    }

    function saveToHistory() {
        const note = document.getElementById('note').value || "ç„¡å‚™è¨»";
        const nameA = document.getElementById('nameA').value;
        const nameB = document.getElementById('nameB').value;
        const selA = document.getElementById('uA');
        const selB = document.getElementById('uB');

        const kgA = document.getElementById('kgA').innerText;
        const kgB = document.getElementById('kgB').innerText;
        const win = document.getElementById('winnerLabel').innerText;
        const date = new Date().toLocaleDateString();

        if (kgA === "--" || kgB === "--") return;

        // åˆ¤æ–·ç²å‹è€…æ˜¯èª°ï¼Œå­˜å…¥æ¨™è¨˜
        let winnerSide = "";
        if (parseFloat(kgA) < parseFloat(kgB)) winnerSide = "A";
        else if (parseFloat(kgB) < parseFloat(kgA)) winnerSide = "B";

        const record = { 
            id: Date.now(), date, note, nameA, nameB, 
            pA: document.getElementById('pA').value, qA: document.getElementById('qA').value, unitA: selA.options[selA.selectedIndex].text,
            pB: document.getElementById('pB').value, qB: document.getElementById('qB').value, unitB: selB.options[selB.selectedIndex].text,
            kgA, kgB, win, winnerSide 
        };
        
        let list = JSON.parse(localStorage.getItem('shopRecords') || "[]");
        list.unshift(record);
        localStorage.setItem('shopRecords', JSON.stringify(list));
        document.getElementById('note').value = "";
        renderHistory();
    }

    function renderHistory() {
        const list = JSON.parse(localStorage.getItem('shopRecords') || "[]");
        const tbody = document.getElementById('historyBody');
        tbody.innerHTML = "";

        list.forEach(item => {
            // æ ¹æ“š winnerSide å¥—ç”¨ä¸åŒçš„ CSS é¡åˆ¥
            let winClass = "";
            if (item.winnerSide === "A") winClass = "win-A";
            else if (item.winnerSide === "B") winClass = "win-B";

            tbody.innerHTML += `
                <tr>
                    <td><small>${item.date}</small><br><strong>${item.note}</strong></td>
                    <td class="hist-detail">
                        <span style="color:var(--color-A); font-weight:bold;">${item.nameA}:</span> 
                        ${item.qA}${item.unitA} ${item.pA}å…ƒ <strong>($${item.kgA}/kg)</strong><br>
                        <span style="color:var(--color-B); font-weight:bold;">${item.nameB}:</span> 
                        ${item.qB}${item.unitB} ${item.pB}å…ƒ <strong>($${item.kgB}/kg)</strong>
                    </td>
                    <td><span class="${winClass}">${item.win}</span></td>
                    <td><button class="btn-del" onclick="deleteItem(${item.id})">åˆªé™¤</button></td>
                </tr>`;
        });
    }

    function deleteItem(id) {
        let list = JSON.parse(localStorage.getItem('shopRecords') || "[]");
        list = list.filter(i => i.id !== id);
        localStorage.setItem('shopRecords', JSON.stringify(list));
        renderHistory();
    }

    document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', update));
    window.onload = () => { update(); renderHistory(); };
</script>

</body>
</html>
